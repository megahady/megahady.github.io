<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>UDS Signal Viewer</title>
  <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
  <style>
    body {
      font-family: Arial, sans-serif;
      padding: 20px;
      background: #f9f9f9;
    }
    #plot {
      width: 100%;
      height: 900px;
    }
  </style>
</head>
<body>
  <h2>UDS Signal Plotter</h2>

  <input type="file" id="fileInput" accept=".csv" />
  <br><br>

  <label><input type="radio" name="signal" value="pdet" checked /> Pdet</label>
  <label><input type="radio" name="signal" value="pdetcalc" /> Pdet Calculated</label>
  <label><input type="radio" name="signal" value="postpdet" /> Post-Processed</label>
  <label><input type="radio" name="signal" value="postpdetwavelet" /> Wavelet</label>

  <div id="plot"></div>

  <script>
    document.getElementById('fileInput').addEventListener('change', function (e) {
      const file = e.target.files[0];
      if (!file) return;

      const reader = new FileReader();
      reader.onload = function (event) {
        const text = event.target.result;
        const rows = text.trim().split('\n').map(row => row.split(',').map(Number));

        const emg = rows.map(r => r[0]);
        const pves = rows.map(r => r[1]);
        const pabd = rows.map(r => r[2]);
        const pdet = rows.map(r => r[3]);
        const pdetcalc = rows.map(r => r[4]);
        const postpdet = rows.map(r => r[5]);
        const postpdetwavelet = rows.map(r => r[6]);

        const sampleRate = 1000;
        const time = rows.map((_, i) => i / sampleRate / 60); // minutes

        function plot(selectedSignalName) {
          let selectedSignal;
          let selectedLabel;
          let selectedColor;

          if (selectedSignalName === 'pdet') {
            selectedSignal = pdet;
            selectedLabel = 'Pdet';
            selectedColor = 'red';
          } else if (selectedSignalName === 'pdetcalc') {
            selectedSignal = pdetcalc;
            selectedLabel = 'Pdet Calculated';
            selectedColor = 'purple';
          } else if (selectedSignalName === 'postpdet') {
            selectedSignal = postpdet;
            selectedLabel = 'Post-Processed';
            selectedColor = 'orange';
          } else if (selectedSignalName === 'postpdetwavelet') {
            selectedSignal = postpdetwavelet;
            selectedLabel = 'Wavelet';
            selectedColor = 'black';
          }

          const traces = [
            {
              x: time, y: pves, type: 'scatter', fill: 'tozeroy',
              line: {color: 'blue'}, name: 'Pves',
              xaxis: 'x', yaxis: 'y'
            },
            {
              x: time, y: emg, type: 'scatter', fill: 'tozeroy',
              line: {color: 'green'}, name: 'EMG',
              xaxis: 'x2', yaxis: 'y2'
            },
            {
              x: time, y: pabd, type: 'scatter', fill: 'tozeroy',
              line: {color: 'orange'}, name: 'Pabd',
              xaxis: 'x3', yaxis: 'y3'
            },
            {
              x: time, y: selectedSignal, type: 'scatter', fill: 'tozeroy',
              line: {color: selectedColor}, name: selectedLabel,
              xaxis: 'x4', yaxis: 'y4'
            }
          ];

          const layout = {
            grid: {rows: 4, columns: 1, pattern: 'independent'},
            height: 1000,
            showlegend: false,

            xaxis: {title: 'Time (min)'},
            xaxis2: {title: 'Time (min)'},
            xaxis3: {title: 'Time (min)'},
            xaxis4: {title: 'Time (min)'},

            yaxis: {title: 'Pves (cmH₂O)', range: [-20, 100]},
            yaxis2: {title: 'EMG (µV)', range: [0, 10]},
            yaxis3: {title: 'Pabd (cmH₂O)', range: [-20, 100]},
            yaxis4: {title: selectedLabel + ' (cmH₂O)', range: [-20, 100]}
          };

          Plotly.newPlot('plot', traces, layout);
        }

        // Set up radio buttons
        document.querySelectorAll('input[name="signal"]').forEach(radio => {
          radio.addEventListener('change', () => plot(radio.value));
        });

        plot('pdet'); // Initial plot
      };

      reader.readAsText(file);
    });
  </script>
</body>
</html>
